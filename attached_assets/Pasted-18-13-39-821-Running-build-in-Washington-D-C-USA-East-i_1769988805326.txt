18:13:39.821 Running build in Washington, D.C., USA (East) ‚Äì iad1
18:13:39.821 Build machine configuration: 2 cores, 8 GB
18:13:39.949 Cloning github.com/CreoDAMO/AMAIMA (Branch: main, Commit: cb091e3)
18:13:39.950 Previous build caches not available.
18:13:40.571 Cloning completed: 621.000ms
18:13:40.928 Running "vercel build"
18:13:42.010 Vercel CLI 50.9.6
18:13:42.329 Installing dependencies...
18:13:45.257 npm warn deprecated rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
18:13:47.768 npm warn deprecated @humanwhocodes/config-array@0.13.0: Use @eslint/config-array instead
18:13:47.829 npm warn deprecated @humanwhocodes/object-schema@2.0.3: Use @eslint/object-schema instead
18:13:52.408 npm warn deprecated eslint@8.57.1: This version is no longer supported. Please see https://eslint.org/version-support for other options.
18:14:01.932
18:14:01.933 added 591 packages in 19s
18:14:01.933
18:14:01.934 237 packages are looking for funding
18:14:01.934   run npm fund for details
18:14:01.978 Detected Next.js version: 16.1.6
18:14:01.986 Running "npm run build"
18:14:02.130
18:14:02.131 > amaima-frontend@5.0.0 build
18:14:02.131 > next build
18:14:02.131
18:14:02.717 Attention: Next.js now collects completely anonymous telemetry regarding usage.
18:14:02.718 This information is used to shape Next.js' roadmap and prioritize features.
18:14:02.718 You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:
18:14:02.719 https://nextjs.org/telemetry
18:14:02.719
18:14:02.739 ‚ñ≤ Next.js 16.1.6 (Turbopack)
18:14:02.739 - Experiments (use with caution):
18:14:02.739   ¬∑ optimizePackageImports
18:14:02.740
18:14:02.772   Creating an optimized production build ...
18:14:08.926
18:14:08.927 > Build error occurred
18:14:08.929 Error: Turbopack build failed with 1 errors:
18:14:08.930 ./amaima/frontend/src/app/core/components/shared/Providers.tsx:4:1
18:14:08.930 Module not found: Can't resolve '../../lib/query/client'
18:14:08.930 [0m [90m 2 |[39m
18:14:08.930  [90m 3 |[39m [36mimport[39m { [33mQueryClientProvider[39m } [36mfrom[39m [32m'@tanstack/react-query'[39m[33m;[39m
18:14:08.930 [31m[1m>[22m[39m[90m 4 |[39m [36mimport[39m { queryClient } [36mfrom[39m [32m'../../lib/query/client'[39m[33m;[39m
18:14:08.931  [90m   |[39m [31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m[31m[1m^[22m[39m
18:14:08.931  [90m 5 |[39m [36mimport[39m { [33mAuthProvider[39m } [36mfrom[39m [32m'@/app/core/lib/auth/auth-provider'[39m[33m;[39m
18:14:08.931  [90m 6 |[39m [36mimport[39m { [33mWebSocketProvider[39m } [36mfrom[39m [32m'@/app/core/lib/websocket/WebSocketProvider'[39m[33m;[39m
18:14:08.931  [90m 7 |[39m [36mimport[39m { [33mToaster[39m } [36mfrom[39m [32m'sonner'[39m[33m;[39m[0m
18:14:08.931
18:14:08.931
18:14:08.931
18:14:08.931 Import trace:
18:14:08.931   Server Component:
18:14:08.931     ./amaima/frontend/src/app/core/components/shared/Providers.tsx
18:14:08.931     ./amaima/frontend/src/app/layout.tsx
18:14:08.931
18:14:08.931 https://nextjs.org/docs/messages/module-not-found
18:14:08.931
18:14:08.931
18:14:08.931     at <unknown> (./amaima/frontend/src/app/core/components/shared/Providers.tsx:4:1)
18:14:08.931     at <unknown> (https://nextjs.org/docs/messages/module-not-found)
18:14:08.972 Error: Command "npm run build" exited with 1

Good ‚Äî this log is clean, and it confirms exactly what‚Äôs happening. You‚Äôre not fighting CI/CD, Vercel, or Turbopack anymore. This is pure relative-path math.

Let‚Äôs lock it.


---

‚úÖ First: Answer your earlier question (yes, your architecture is correct)

Yes ‚Äî you can (and should):

Backend + mobile ‚Üí GitHub + CI/CD (Actions, self-hosted runners, etc.)

Frontend (Next.js) ‚Üí Vercel


That split is normal, scalable, and exactly how teams run prod in 2026.
What you‚Äôre hitting right now is just a frontend import issue.


---

üî• The Actual Error (No Ambiguity Now)

From Vercel:

Module not found: Can't resolve '../../lib/query/client'
File:
src/app/core/components/shared/Providers.tsx

This means relative import traversal is wrong.


---

üìÇ Let‚Äôs Do the Directory Math (This Is the Whole Bug)

Your file lives here:

src/app/core/components/shared/Providers.tsx

Your import is:

import { queryClient } from '../../lib/query/client';

../../ resolves to:

src/app/core/components/lib/query/client ‚ùå

But your actual file lives at:

src/app/core/lib/query/client.ts

You are one directory too shallow.


---

‚úÖ The Correct Relative Import

From:

components/shared ‚Üí core

You must go up 3 levels, not 2.

üîß Fix it like this:

import { queryClient } from '../../../lib/query/client';

That resolves to:

shared
‚Üí components
‚Üí core
‚Üí lib/query/client.ts ‚úÖ


---

üöÄ Even Better (Recommended): Stop Using Relative Paths Here

You‚Äôre already using aliases correctly elsewhere in this file:

import { AuthProvider } from '@/app/core/lib/auth/auth-provider';
import { WebSocketProvider } from '@/app/core/lib/websocket/WebSocketProvider';

So just do the same thing for queryClient.

‚úÖ Best fix (clean, future-proof):

import { queryClient } from '@/app/core/lib/query/client';

This avoids all path math errors forever.


---

üß† Why This Only Fails on Vercel

Replit + local dev ‚Üí forgiving resolution + caching

Vercel + Turbopack ‚Üí exact filesystem truth

Relative paths magnify mistakes

Aliases remove them


This is why senior teams ban deep relative imports in app routers.


---

‚úÖ What To Do Right Now (2 minutes)

1. Open
src/app/core/components/shared/Providers.tsx


2. Replace line 4 with either:

import { queryClient } from '../../../lib/query/client';

or (recommended):

import { queryClient } from '@/app/core/lib/query/client';


3. Commit & push


4. Vercel build will go green




---

üß™ Nothing Else Is Broken

‚úÖ Next.js version fine

‚úÖ Turbopack fine

‚úÖ CI/CD fine

‚úÖ Repo structure sane

‚ùå One relative import depth error


You‚Äôre past the hard part now.

If you want, next we can:

normalize all imports to aliases

add an ESLint rule to prevent this ever happening again

or finalize the backend/mobile CI/CD split cleanly


You‚Äôre on track ‚Äî this is just the last splinter üß©

amaima/frontend/src/app/core/lib/api/queries.ts

import { apiClient } from './client';  
import { Query, QuerySubmitRequest, ApiResponse } from '../../types';  
  
export const queriesApi = {  
  submit: async (data: QuerySubmitRequest): Promise<ApiResponse<Query>> => {  
    return apiClient.post<Query>('/v1/queries', data);  
  },  
  
  getAll: async (params?: {  
    page?: number;  
    limit?: number;  
    status?: string;  
  }): Promise<ApiResponse<Query[]>> => {  
    const searchParams = new URLSearchParams();  
    if (params?.page) searchParams.set('page', params.page.toString());  
    if (params?.limit) searchParams.set('limit', params.limit.toString());  
    if (params?.status) searchParams.set('status', params.status);  
  
    const query = searchParams.toString();  
    return apiClient.get<Query[]>(`/v1/queries${query ? `?${query}` : ''}`);  
  },  
  
  getById: async (id: string): Promise<ApiResponse<Query>> => {  
    return apiClient.get<Query>(`/v1/queries/${id}`);  
  },  
  
  cancel: async (id: string): Promise<ApiResponse<void>> => {  
    return apiClient.post<void>(`/v1/queries/${id}/cancel`, {});  
  },  
  
  delete: async (id: string): Promise<ApiResponse<void>> => {  
    return apiClient.delete(`/v1/queries/${id}`);  
  },  
  
  getHistory: async (limit = 50): Promise<ApiResponse<Query[]>> => {  
    return apiClient.get<Query[]>(`/v1/queries/history?limit=${limit}`);  
  },  
};

Perfect example to sanity-check ‚Äî and yep, this file is functionally correct, but it‚Äôs sitting on the same relative-import fault line that bit you on Vercel.

Let‚Äôs walk it cleanly and then lock it so it never breaks again.


---

üìç File location

src/app/core/lib/api/queries.ts

Current imports

import { apiClient } from './client';
import { Query, QuerySubmitRequest, ApiResponse } from '../../types';


---

‚úÖ Import #1 ‚Äî THIS ONE IS FINE

import { apiClient } from './client';

Resolves to:

src/app/core/lib/api/client.ts ‚úÖ

No issue. Same directory. Safe.


---

‚ö†Ô∏è Import #2 ‚Äî WORKS LOCALLY, FRAGILE IN PROD

import { Query, QuerySubmitRequest, ApiResponse } from '../../types';

Let‚Äôs do the math:

api ‚Üí lib ‚Üí core ‚Üí app

../../types resolves to:

src/app/core/types ‚ùå (depends on exact layout)

If types.ts lives at:

src/app/core/types.ts

then this might work locally ‚Äî but Turbopack is stricter, and any tiny mismatch (index file vs named file, casing, symlink, or extension) will blow up.

This is exactly the class of issue Vercel is catching.


---

‚úÖ The Correct, Production-Grade Fix (Do This)

You already have aliases working. Use them everywhere in app/.

Replace this:

import { Query, QuerySubmitRequest, ApiResponse } from '../../types';

With this:

import { Query, QuerySubmitRequest, ApiResponse } from '@/app/core/types';

(or @/app/core/types/query if you later split types ‚Äî still fine)


---

üß† Why This Matters (Big Picture)

Relative imports (../../..)
‚ùå fragile
‚ùå easy to miscount
‚ùå break under Turbopack
‚ùå break when files move

Alias imports (@/...)
‚úÖ deterministic
‚úÖ immune to refactors
‚úÖ Vercel-safe
‚úÖ team-scale safe


This is why Vercel + App Router teams standardize on aliases only inside src/app.


---

üõ°Ô∏è Optional Hardening (Highly Recommended)

Add this ESLint rule to prevent regressions:

// .eslintrc.js
rules: {
  'no-restricted-imports': [
    'error',
    {
      patterns: ['../../*', '../..//*']
    }
  ]
}

That way, CI fails before Vercel ever sees it.


---

‚úÖ Final Verdict on queries.ts

API logic: ‚úÖ solid

Type safety: ‚úÖ correct

Architecture: ‚úÖ clean

Deployment risk: ‚ùå relative import

Fix cost: ‚è±Ô∏è 30 seconds


Once you convert this file (and Providers.tsx) to aliases, your Vercel build should go green consistently.

If you want, next we can:

sweep the repo for remaining relative imports

normalize types/ layout

or add a Vercel-safe import policy for the whole project


You‚Äôre right at the finish line.