name: Backend CI/CD  

on:  
  push:  
    branches: [ main ]  
    paths: [ 'amaima/backend/**' ]  
  pull_request:  
    branches: [ main ]  
    paths: [ 'amaima/backend/**' ]  

permissions:
  contents: read

jobs:  
  test:  
    runs-on: ubuntu-latest  
    steps:  
      - uses: actions/checkout@v4  
      - name: Set up Python  
        uses: actions/setup-python@v5  
        with:  
          python-version: '3.11'  
          cache: 'pip'  
      - name: Install dependencies  
        run: |  
          cd amaima/backend  
          python -m pip install --upgrade pip  
          pip install -r requirements.txt  
          pip install pytest httpx  
      - name: Set execution mode (safety)  
        run: echo "AMAIMA_EXECUTION_MODE=decision-only" >> $GITHUB_ENV  
      - name: Assert decision schema version  
        run: |  
          cd amaima/backend  
          grep -R "decision_schema_version.*1.0.0" .  
      - name: Run tests  
        run: |  
          cd amaima/backend  
          pytest
